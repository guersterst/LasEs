<ui:composition template="/resources/templates/main.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:pg="http://xmlns.jcp.org/jsf/composite/templates/composites/pagination"
                xmlns:col="http://xmlns.jcp.org/jsf/composite/templates/composites/sortsearchcolumn"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">

    <!-- page title -->
    <ui:define name="title">#{scientificForumBacking.forum.name}</ui:define>

    <!-- content of scientificForum.xhtml -->
    <ui:define name="content">

        <f:metadata>
            <f:viewParam value="#{scientificForumBacking.forum.id}" name="id"/>
            <!--TODO:evtl mit parameter Ã¼bergabe-->
            <f:event type="preRenderView" listener="#{scientificForumBacking.preRenderViewListener}"/>
            <f:viewAction action="#{scientificForumBacking.onLoad()}"/>
        </f:metadata>

        <div class="container-fluid">
            <div class="row">
                <div class="col-md-10">
                    <div class="container" id="container-forum">
                        <div class="card" id="toolbox">

                            <!-- header -->
                            <div class="card-header">
                                <div class="row">
                                    <div class="col">

                                        <!-- delete forum -->
                                        <h:commandButton styleClass="btn btn-primary" id="delete-sub-cbtn"
                                                         title="#{help.deleteSubmission}"
                                                         value="#{labels.deleteButton}"
                                                         onclick="PF('dlg').show()"
                                                         rendered="#{scientificForumBacking.sessionInformation.user.admin}"/>
                                        <p:dialog id="delete-forum-dlg" widgetVar="dlg">
                                            <div class="text-center">
                                                <h:outputText id="delete-warning-otxt"
                                                              value="#{message.deleteWarningOtxt}"/>
                                            </div>
                                            <br/>
                                            <div class="text-center">
                                                <h:form>
                                                    <h:commandButton styleClass="btn btn-primary" id="agree-delete-cbtn"
                                                                     value="#{labels.agreeButton}"
                                                                     action="#{scientificForumBacking.deleteForum()}"/>
                                                </h:form>
                                            </div>
                                        </p:dialog>
                                    </div>
                                </div>
                            </div>

                            <!--General inomformation about the forum-->
                            <div class="card-body">
                                <h:form id="info-forum">
                                    <div class="row">

                                        <!-- leftmost column -->
                                        <div class="col-md-6">

                                            <!-- name -->
                                            <h:inputText id="forum-name-itxt"
                                                         value="#{scientificForumBacking.forum.name}"
                                                         readonly="#{!scientificForumBacking.loggedInUserIsEditor()}"
                                                         required="true"
                                                         requiredMessage="#{message.forumName}"
                                                         styleClass="h4"/>
                                            <br/>

                                            <div class="body">

                                                <!-- desc -->
                                                <h:inputText id="description-itxt"
                                                             value="#{scientificForumBacking.forum.description}"
                                                             readonly="#{!scientificForumBacking.loggedInUserIsEditor()}"
                                                             rendered="#{scientificForumBacking.loggedInUserIsEditor()}"
                                                             required="true"
                                                             requiredMessage="#{message.description}"
                                                             styleClass="h4"/>

                                                <!-- alternative desc output for non editors -->
                                                <h:outputText id="description-otxtx"
                                                              value="#{scientificForumBacking.forum.description}"
                                                              rendered="#{!scientificForumBacking.loggedInUserIsEditor()}"
                                                              styleClass="h4"/>
                                            </div>
                                            <div class="body">
                                                <!-- url -->
                                                <h:inputText id="change-url-itxt"
                                                             value="#{scientificForumBacking.forum.url}"
                                                             rendered="#{scientificForumBacking.loggedInUserIsEditor()}"/>

                                                <!-- alternative url output for non editors -->
                                                <h:outputLink value="#{scientificForumBacking.forum.url}"
                                                              rendered="#{!scientificForumBacking.loggedInUserIsEditor()}">
                                                    <h:outputText value="#{scientificForumBacking.forum.url}"/>
                                                </h:outputLink>
                                            </div>
                                        </div>

                                        <!-- deadline for submission -->
                                        <!-- todo hier text input? -> converter -->
                                        <!--
                                        <h:inputText id = "deadline-itxt"
                                                     value = "#{scientificForumBacking.forum.deadline}"
                                                     readonly="#{!scientificForumBacking.loggedInUserIsEditor()}"
                                                     required="true"
                                                     requiredMessage="#{message.deadline}" />
                                                     -->

                                        <!-- editor column -->
                                        <div class="col-md-3">
                                            <div class="form-group">

                                                <!-- editor controls -->
                                                <!-- todo rendered -->

                                                <!-- add editor -->
                                                <div class="form-group">
                                                    <h:outputLabel for="editor-email-itxt" value="#{labels.email}"/>
                                                    <!-- todo req. message und label und hilfe text-->
                                                    <h:inputText id="editor-email-itxt"
                                                                 value="#{scientificForumBacking.newEditorInput}"
                                                                 class="form-control"
                                                                 requiredMessage="#{message.emailRequired}"/>
                                                    <!-- todo message aus service -->
                                                    <h:message for="editor-email-itxt"/>
                                                </div>
                                                <div class="form-group">
                                                    <h:commandButton id="add-editor-cbtn" value="#{labels.add}"
                                                                     styleClass="btn btn-secondary"
                                                                     type="submit"
                                                                     action="#{scientificForumBacking.addEditor()}">
                                                        <!-- todo what about this -> render & execute list-->
                                                        <f:ajax execute="info-forum" render="info-forum"/>
                                                    </h:commandButton>
                                                </div>

                                                <!--- editor list -->
                                                <h:dataTable id="editor-list" value="#{scientificForumBacking.editors}"
                                                             var="editor">
                                                    <h:column>
                                                        <f:facet name="header">#{labels.editors}</f:facet>
                                                        #{editor.title}
                                                        #{editor.firstName}
                                                        #{editor.lastName}
                                                        <h:commandButton id="delete-editor-cbtn"
                                                                         value="#{labels.delete}"
                                                                         styleClass="btn-secondary btn" type="submit"
                                                                         action="#{scientificForumBacking.removeEditor(editor)}">
                                                            <!-- todo -->
                                                            <f:ajax execute="info-forum" render="info-forum"/>
                                                        </h:commandButton>
                                                    </h:column>
                                                </h:dataTable>
                                            </div>
                                        </div>

                                        <!-- science field column -->
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <!-- add sciencefield -->
                                                <!-- todo converter? -->
                                                <!-- todo rendered -->
                                                <!-- todo duplicates -->
                                                <div class="p-field p-col-12 p-md-4">
                                                    <h:form id="fields-add-frm">
                                                        <div class="form-group">
                                                            <p:outputLabel for="@next"
                                                                           value="#{labels.addScienceField}"/>
                                                            <p:selectOneMenu id="advanced"
                                                                             value="#{scientificForumBacking.selectedScienceFieldInput}"
                                                                             panelStyle="width:180px"
                                                                             effect="fade"
                                                                             var="s"
                                                                             filter="true"
                                                                             filterMatchMode="startsWith">
                                                                <f:selectItems
                                                                        value="#{scientificForumBacking.allScienceFields}"
                                                                        var="scienceField"
                                                                        itemLabel="#{scienceField.name}"
                                                                        itemValue="#{scienceField}"/>

                                                                <p:column>
                                                                    <f:facet name="header">
                                                                        <h:outputText value="Name"/>
                                                                    </f:facet>
                                                                    <h:outputText value="#{s.name}"/>
                                                                </p:column>
                                                            </p:selectOneMenu>
                                                            <h:commandButton id="apply-field-add-cbtn"
                                                                             value="#{labels.add}"
                                                                             action="#{scientificForumBacking.addScienceField}"/>
                                                            <!-- todo add f:ajax to reload form -->
                                                        </div>
                                                    </h:form>
                                                </div>

                                                <!-- fields list -->
                                                <h:form id="fields-list-frm">
                                                    <h:dataTable id="science-field-list"
                                                                 value="#{scientificForumBacking.currentScienceFields}"
                                                                 var="currField">
                                                        <h:column>
                                                            <f:facet name="header">#{labels.scienceFields}</f:facet>
                                                            #{currField.name}
                                                            <h:commandButton id="delete-field-cbtn"
                                                                             value="#{labels.delete}"
                                                                             styleClass="btn-secondary btn"
                                                                             type="submit"
                                                                             action="#{scientificForumBacking.removeScienceField(currField)}">
                                                                <!-- todo -->
                                                                <f:ajax execute="fields-list-frm"
                                                                        render="fields-list-frm"/>
                                                            </h:commandButton>
                                                        </h:column>
                                                    </h:dataTable>
                                                </h:form>
                                            </div>
                                        </div>
                                    </div>

                                </h:form>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- submission pagination -->
                <div id="submission-pagination">
                    <div class="container">
                        <div class="card">
                            <div class="card-head">
                                <!-- Tabs for the different views -->
                                <h:form>
                                    <ul class="nav nav-tabs justify-content-center">
                                        <li class="nav-item">
                                            <h:commandLink value="#{labels['ownSubmissions']}"
                                                           action="#{scientificForumBacking.displayOwnSubmissionsTab()}"
                                                           styleClass="#{'nav-link'.concat(scientificForumBacking.getOwnCssClassSuffix())}"/>
                                        </li>
                                        <li class="nav-item">
                                            <h:commandLink value="#{labels['reviewedSubmissions']}"
                                                           action="#{scientificForumBacking.displayReviewSubmissionsTab()}"
                                                           styleClass="#{'nav-link'.concat(scientificForumBacking.getReviewCssClassSuffix())}"/>
                                        </li>
                                        <li class="nav-item">
                                            <h:commandLink value="#{labels['editedSubmissions']}"
                                                           action="#{scientificForumBacking.displayEditSubmissionsTab()}"
                                                           styleClass="#{'nav-link'.concat(scientificForumBacking.getEditCssClassSuffix())}"/>
                                        </li>
                                    </ul>
                                </h:form>
                            </div>

                            <div class="card-body">
                                <h:form>
                                    <!-- Filter controls -->
                                    <div class="btn-group">
                                        <!-- Date filtering -->
                                        <h:selectOneMenu id="date-slctom"
                                                         value="#{scientificForumBacking.submissionPagination.resultListParameters.dateSelect}"
                                                         title="#{help.dateSelect}"
                                                         styleClass="btn btn-secondary">
                                            <f:selectItems value="#{scientificForumBacking.dateSelects}"
                                                           var="select"
                                                           itemLabel="#{labels['dateSelect.' += select]}"
                                                           itemValue="#{select}"/>
                                        </h:selectOneMenu>
                                        <!-- Submission state filtering -->
                                        <h:selectOneMenu id="state-slctom"
                                                         value="#{scientificForumBacking.submissionPagination.resultListParameters.submissionState}"
                                                         title="#{help.stateSubSelect}"
                                                         styleClass="btn btn-secondary">
                                            <f:selectItem itemValue="#{null}"
                                                          itemLabel="#{labels['stateSelect.ALL']}"/>
                                            <f:selectItems value="#{scientificForumBacking.submissionStates}"
                                                           var="select"
                                                           itemLabel="#{labels['stateSelect.' += select]}"
                                                           itemValue="#{select}"/>
                                        </h:selectOneMenu>
                                    </div>
                                    <pg:pagination paginator="#{scientificForumBacking.submissionPagination}">
                                        <h:column>
                                            <f:facet name="header">
                                                <col:sortsearchcolumn id="title-ssc"
                                                                      paginator="#{scientificForumBacking.submissionPagination}"
                                                                      columnIdentifier="title"
                                                                      columnNamei18n="#{labels.title}"/>
                                            </f:facet>
                                            <h:link value="#{var.title}"
                                                    outcome="/views/authenticated/submission"
                                                    includeViewParams="true">
                                                <f:param name="id" value="#{var.id}"/>
                                            </h:link>
                                        </h:column>

                                        <h:column>
                                            <f:facet name="header">
                                                <div class="input-group">
                                                    <h:outputText value="#{labels.date}"
                                                                  styleClass="input-group-text"/>
                                                </div>
                                            </f:facet>
                                            <h:outputText value="#{var.submissionTime}">
                                                <f:convertDateTime type="localDate"/>
                                            </h:outputText>
                                        </h:column>

                                        <h:column>
                                            <f:facet name="header">
                                                <div class="input-group">
                                                    <h:outputText value="#{labels.deadline}"
                                                                  styleClass="input-group-text"/>
                                                </div>
                                            </f:facet>
                                            <h:outputText value="#{var.deadlineRevision}">
                                                <f:convertDateTime type="localDate"/>
                                            </h:outputText>
                                        </h:column>

                                        <h:column>
                                            <f:facet name="header">
                                                <div class="input-group">
                                                    <h:outputText value="#{labels.stateSub}"
                                                                  styleClass="input-group-text"/>
                                                </div>
                                            </f:facet>
                                            <h:outputText id="state-otxt" value="#{var.state}"/>
                                        </h:column>
                                    </pg:pagination>
                                </h:form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ui:define>
</ui:composition>

