@startuml
'https://plantuml.com/sequence-diagram

'!theme aws-orange
skinparam sequenceMessageAlign center
skinparam BoxPadding 10
'autonumber
'autoactivate on

actor Editor as editor
box "control.backing"
    participant ":SubmissionBacking" as subBacking
end box
box "???"
    participant ":ResourceBundle" as rscBundle
end box
box "service?"
    participant ":SubmissionService" as subService
end box
box "dtos"
    participant "sub:Submission" as sub
end box
box "business.util"
participant ":EmailService" as emailService
end box
box persistence
    participant ":SubmissionRepository" as subRepo
    participant ":ConnectionPool" as connPool
end box
database "Database" as db

editor -> subBacking ** : init()
note left
    ruft die
    Submission-
    Seite auf
end note
activate subBacking
        subBacking -> subService : getSubmission(subId)
        activate subService
            subService -> subRepo : getSubmission(subId)
            activate subRepo
                subRepo -> connPool : getConnection()
                activate connPool
                return conn
                subRepo -> db : SQL-req
                activate db
                return res
                subRepo -> connPool : releaseConnection()
                    activate connPool
                    return
                create sub
                subRepo -> sub
            return sub : Submission
        return sub : Submission
return submission.xhtml

editor -> subBacking : reject()
note left
    klickt auf "Reject"
end note
activate subBacking
    subBacking -> subService : reject(sub)
    activate subService
        subService -> sub : getAuthorEmailAddresses()
        activate sub
        return addrs
        subService -> rscBundle : getRejectionEmailSubject()
        activate rscBundle
        return subject
        subService -> rscBundle : getRejectionEmailBody()
        activate rscBundle
        return body

        subService -> emailService : generateMailto(addrs, subject, body)
        activate emailService
        return mailtoLink

        subService -> subRepo : updateSubmission(subId, sub)
        activate subRepo
            subRepo -> db : SQL-req
            activate db
            note right
                Fehler bei
                Datenbank-
                zugriff
            end note
== Anfang Fehlerbehandlung ==
            return <font color=red><b>âš¡
        return <font color=red><b>irgende persistence-Exception
    return <font color=red><b>irgendne business-Exception

    subBacking -> rscBundle : getRejectSubmission\\\nUnsuccessfulMessage()
    activate rscBundle
    return msg

return submission.xhtml\nmit <font color=red><b>Fehlermeldung</b></font>\nals FacesMessage
note left
Die Ablehnung war
nicht erfolgreich
end note


@enduml